--- entrance/data/config/build_config.sh.in	2004-04-11 00:23:16.000000000 +0200
+++ entrance/data/config/build_config.sh.in.new	2005-01-08 15:49:36.768610184 +0100
@@ -1,5 +1,5 @@
 #!/bin/sh -e
-DB="./entrance_config.cfg"
+DB="/var/lib/entrance/entrance_config.cfg"
 rm -f $DB
 
 # set auth to 1 for pam, 2 for shadow
@@ -19,6 +19,8 @@
 #ecore_config $DB set /entrance/fonts/1/str str "/usr/X11R6/lib/X11/fonts/Truetype/"
 ecore_config $DB set /entrance/greeting/before str "Welcome to"
 ecore_config $DB set /entrance/greeting/after str ""
+
+dont_run() {
 ecore_config $DB set /entrance/session/count int 8
 ecore_config $DB set /entrance/session/0/session str "default"
 ecore_config $DB set /entrance/session/0/title str "Default"
@@ -41,6 +43,23 @@
 ecore_config $DB set /entrance/session/6/session str "failsafe"
 ecore_config $DB set /entrance/session/6/title str "Failsafe"
 ecore_config $DB set /entrance/session/6/icon str "failsafe.png"
+}
+
+ecore_config $DB set /entrance/session/count int @COUNT@
+# lines starting with ^#session: will be parsed for each .desktop file
+# in /usr/share/xsessions where:
+# @SESSION@	is Exec=(*)
+# @TITLE@	is Name=(*)
+# @ICON@	is entrance icon if exist, or default 
+# 			see /usr/share/entrance/images/sessions/
+# everything will be in /tmp/sessions
+
+#session:ecore_config $DB set /entrance/session/@NUM@/session str "@SESSION@"
+#session:ecore_config $DB set /entrance/session/@NUM@/title str "@TITLE@"
+#session:ecore_config $DB set /entrance/session/@NUM@/icon str "@ICON@"
+
+. /tmp/sessions
+
 ecore_config $DB set /entrance/system/reboot int 1
 ecore_config $DB set /entrance/system/halt int 1
 ecore_config $DB set /entrance/user/remember int 1
--- entrance/data/Makefile.am	2003-10-22 13:29:59.000000000 +0200
+++ entrance/data/Makefile.am.new	2005-01-08 15:50:12.962107936 +0100
@@ -1,2 +1,2 @@
-SUBDIRS = config images themes fonts users
+SUBDIRS = images themes fonts users
 
